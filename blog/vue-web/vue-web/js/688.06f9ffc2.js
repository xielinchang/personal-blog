"use strict";(self["webpackChunkvueforblog"]=self["webpackChunkvueforblog"]||[]).push([[688],{86688:function(t,s,e){e.r(s),e.d(s,{default:function(){return _}});var i=function(){var t=this,s=t._self._c;return s("div",{staticClass:"body"},[s("my-loading",{attrs:{"load-show":t.loading,"fixed-top":"400"}},[s("TemplatePage"),s("div",{ref:"scrollBar",staticClass:"main-body"},[s("div",{staticClass:"main-container"},[s("div",{staticClass:"banner"},[s("div",{staticClass:"baner-mark"},[s("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.prefix+t.essayForm.coverUrl,expression:"prefix + essayForm.coverUrl"}],staticClass:"mark"}),s("div",{staticClass:"shadow-mark"}),s("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.prefix+t.essayForm.coverUrl,expression:"prefix + essayForm.coverUrl"}],staticClass:"banner-img"})]),s("MyBuble",{staticClass:"buble"}),s("div",{staticClass:"banner-tit-box"},[s("div",{staticClass:"banner-title"},[t._v(t._s(t.essayForm.title))]),s("div",{staticClass:"banner-line"}),s("div",{staticClass:"banner-subtitle"},[t._v(t._s(t.essayForm.subtitle))]),s("div",{staticClass:"updated-time"},[t._v(" 最近更新："+t._s(t.essayForm.updated_at)+" ")])])],1),s("catalog",{directives:[{name:"show",rawName:"v-show",value:t.catalog.length>0&&t.catalogShow,expression:"catalog.length > 0 && catalogShow"}],attrs:{catalog:t.catalog,over:t.overHeight},on:{"jump-catalog":t.jumpToCatalog}}),s("div",{staticClass:"main-page",style:{width:t.catalog.length>0&&t.catalogShow?"78%":"100%"}},[""!==t.essayForm.digest?s("div",{staticClass:"digest block",attrs:{id:"digest"}},[s("div",{staticClass:"digest-content"},[s("div",{staticClass:"digest-head"},[s("svg-icon",{staticClass:"digest-icon",attrs:{color:"#1DA9E0",size:"20px","icon-name":"digest","right-title":"摘要"}}),s("p",[t._v("简要的摘要能帮助读者更好的理解文章")])],1),t._v(" "+t._s(t.essayForm.digest)+" ")])]):t._e(),s("div",{staticClass:"essay"},[s("div",{ref:"aContent",staticClass:"essay-content",domProps:{innerHTML:t._s(t.essayForm.html)}}),s("div",{staticClass:"operation block"},[s("div",{staticClass:"good-icon",on:{click:t.addGood}},[t.isGood?s("svg-icon",{attrs:{"icon-name":"good-filled",size:"20px",color:"#ffa109"}}):s("svg-icon",{attrs:{"icon-name":"good",size:"20px",color:"#666"}}),t._v(" "+t._s(t.essayData.good)+" ")],1),s("div",{staticClass:"collect-icon",on:{click:t.addCollect}},[!0===t.isCollect?s("svg-icon",{attrs:{"icon-name":"collect-filled",size:"20px",color:"#ffa109"}}):s("svg-icon",{attrs:{color:"#666","icon-name":"collect",size:"20px"}}),t._v(" "+t._s(t.essayData.collect)+" ")],1),s("div",{staticClass:"comment-icon",on:{click:function(s){t.publishShow=!t.publishShow}}},[s("svg-icon",{attrs:{color:"#666","icon-name":"comment",size:"20px"}}),t._v(" "+t._s(t.commentNum)+" ")],1)])]),s("div",{staticClass:"comment"},[s("div",{staticClass:"c-publish",class:t.publishShow?"":"c-publish-close"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.commentForm.message,expression:"commentForm.message"}],attrs:{id:"input",placeholder:"请输入评论，最多不超过200字",rows:"5",maxlength:"200"},domProps:{value:t.commentForm.message},on:{click:function(s){t.showDialog=!1},input:function(s){s.target.composing||t.$set(t.commentForm,"message",s.target.value)}}}),s("div",{staticClass:"emoji-btn",on:{click:t.emojiShow}},[t._v("Emoji😃")]),s("div",{staticClass:"c-publish-btn",on:{click:t.publishComment}},[s("svg-icon",{staticClass:"publish-icon",attrs:{"icon-name":"publish",size:"24px",color:"#00B753"}}),s("span",[t._v("发布")])],1),s("VEmojiPicker",{directives:[{name:"show",rawName:"v-show",value:t.showDialog,expression:"showDialog"}],staticClass:"emoji-picker",on:{select:t.selectEmoji}})],1),t.commentList.length>0?s("ul",{staticClass:"comment-list block"},t._l(t.commentList,(function(e,i){return s("li",{key:i},[s("div",{staticClass:"c-portrait"},[s("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.prefix+e.users[0].portrait,expression:"prefix + item.users[0].portrait"}],attrs:{alt:""}})]),s("div",{staticClass:"c-right"},[s("div",{staticClass:"c-top"},[s("div",{staticClass:"c-name"},[t._v(t._s(e.users[0].name))]),s("div",{staticClass:"c-address"},[t._v(t._s(e.address))])]),s("div",{staticClass:"c-publish-time"},[t._v(t._s(e.created_at))]),s("div",{staticClass:"c-msg"},[t._v(" "+t._s(e.message)+" ")])])])})),0):s("div",{staticClass:"no-comments"},[t._v("暂 无 评 论")])])])],1)]),s("div",{staticClass:"icon-buttons"},[s("icon-button",{staticClass:"icon-button",attrs:{icon:"comment-filled","left-title":"评论"},nativeOn:{click:function(s){return t.jumpToComment()}}}),s("icon-button",{directives:[{name:"show",rawName:"v-show",value:t.catalog.length>0,expression:"catalog.length > 0"}],staticClass:"icon-button",attrs:{icon:"hide-filled","left-title":t.catalogShow?"隐藏目录":"打开目录"},nativeOn:{click:function(s){t.catalogShow=!t.catalogShow}}}),s("icon-button",{staticClass:"icon-button",attrs:{icon:"left","left-title":"上一篇"},nativeOn:{click:function(s){return t.preEssay()}}}),s("icon-button",{staticClass:"icon-button",attrs:{icon:"right","left-title":"下一篇"},nativeOn:{click:function(s){return t.nextEssay()}}})],1)],1)],1)},o=[],a=(e(57658),e(39253)),l=e(26128),n=e(68828),c=e(77736);function r(t){return(0,c.Z)({url:"/essay/comments/query",method:"post",data:t})}function d(t){return(0,c.Z)({url:"/essay/comments/create",method:"post",data:t})}var h=e(24418),m=function(){var t=this,s=t._self._c;return s("div",[s("div",{staticClass:"catalog-box block",style:t.justStyle},[t._m(0),s("ul",{staticClass:"catalog"},t._l(t.catalog,(function(e,i){return s("li",{key:i,class:t.activeIndex===i?"active":"",on:{click:function(s){return t.jumpCatalog(e)}}},[t._v(" "+t._s(e.key)+" ")])})),0)])])},u=[function(){var t=this,s=t._self._c;return s("div",{staticClass:"catalog-tit"},[s("span",[t._v("目录:")])])}],g={name:"EssayCatalog",props:{catalog:{type:Array,default:()=>[]},over:{type:[Number],default:0}},emits:["jump-catalog"],data(){return{activeIndex:"",scrollHeight:""}},computed:{justStyle(){return this.scrollHeight>470?{position:"fixed",top:"60px",right:"10%",width:"16%"}:{position:"absolute",top:"445px",right:0,width:"20%"}}},created(){window.addEventListener("scroll",this.onScroll)},methods:{onScroll(){var t=document.documentElement.scrollTop||document.body.scrollTop;this.scrollHeight=t;const s=document.documentElement.scrollTop;for(let e=0;e<this.catalog.length;e++)s>this.catalog[e].offset+this.over&&s<this.catalog[e+1].offset+this.over&&(this.activeIndex=e)},jumpCatalog(t){this.$emit("jump-catalog",t)}}},v=g,p=e(1001),y=(0,p.Z)(v,m,u,!1,null,"51eb9de0",null),f=y.exports,C={name:"EssayPage",components:{catalog:f},data(){return{essayForm:{essay_id:"",coverUrl:"",title:"",subtitle:"",digest:"",html:""},commentForm:{user_id:"",essay_id:"",message:"",portrait:"",name:"",address:""},isGood:!1,isCollect:!1,essayData:{id:this.$route.query,essay_id:null,good:0,collect:0},query:this.$route.query,commentNum:0,publishShow:!1,showDialog:!1,commentList:[],userDetail:{},collectIds:[],goodIds:[],loading:!1,catalog:[],catalogShow:!0,prefix:"http://1.94.31.132:7001",overHeight:0}},watch:{"$route.query":{handler(t,s){this.query.id=t.id,this.init()},deep:!0}},created(){this.init()},methods:{init(){this.initUser(),this.initEssay(),this.initComments()},changeEssay(t){(0,n.Yv)({limit:999,offset:1,query:{id:void 0,title:void 0,subtitle:void 0,domain:void 0}}).then((s=>{const e=s.data.rows,i=e.findIndex((t=>1*t.id===1*this.query.id));1*i===e.length-1&&"next"===t?this.$msg({content:"已经是最后一篇了",type:"info"}):1*i===0&&"pre"===t?this.$msg({content:"已经是第一篇了",type:"info"}):"next"===t?this.$router.push("/note/essay?id="+e[i+1].id):"pre"===t&&this.$router.push("/note/essay?id="+e[i-1].id)}))},preEssay(){this.changeEssay("pre")},nextEssay(){this.changeEssay("next")},selectEmoji(t){const s=document.getElementById("input"),e=s.selectionStart,i=s.selectionEnd,o=s.value.substring(0,e)+t.data+s.value.substring(i);s.value=o,setTimeout((function(){s.focus()}),200),s.selectionStart=e+t.data.length,s.selectionEnd=i+t.data.length,this.commentForm.message=o},emojiShow(){this.showDialog=!this.showDialog;const t=document.getElementById("input");t.value=t.value.substring(0,t.length)},emojiPickerOff(){this.showDialog=!1},disableScroll(){document.addEventListener("wheel",this.preventDefault,{passive:!1})},enableScroll(){document.removeEventListener("wheel",this.preventDefault,{passive:!1})},preventDefault(t){t.preventDefault()},initEssay(){var t=this;this.loading=!0,(0,n.Yv)({limit:1,offset:1,query:{id:1*this.query.id,title:void 0,subtitle:void 0,domain:void 0}}).then((s=>{"/note/essay"===this.$route.path&&(document.title=s.data.rows[0].title),s.data.rows[0].essay_detail?t.essayData=s.data.rows[0].essay_detail:t.essayData={id:null,essay_id:this.query.id,good:0,collect:0},t.essayForm=s.data.rows[0],setTimeout((()=>{t.initCatalog(),t.loading=!1}),1e3)}))},initCatalog(){this.catalog=[];var t=document.querySelectorAll("h1, h2, h3, h4, h5, h6, h7");for(let e=0;e<t.length;e++){const s=t[e];s.id="h-"+1*(e+1),this.catalog.push({key:s.innerText,id:s.id,offset:s.offsetTop})}if(this.essayForm.digest){var s=document.getElementById("digest").offsetHeight;this.overHeight=s+440}else this.overHeight=440},jumpToCatalog(t){const s=document.documentElement,e=this;var i=document.getElementById(t.id).offsetTop,o=s.scrollTop,a=40,l=!1,n=this.overHeight;if(i<o)a=-a,l=!0;else if(i===o)return;var c=setInterval((()=>{e.disableScroll(),l?o+a<i?(s.scrollTop=i+n,e.enableScroll(),clearInterval(c)):s.scrollTop=o+a+n:o+a>i?(s.scrollTop=i+n,e.enableScroll(),clearInterval(c)):s.scrollTop=o+a+n,o+=a}),5)},initComments(){r({limit:999,offset:1,query:{essay_id:this.query.id}}).then((t=>{this.commentNum=t.data.count,this.commentList=t.data.rows}))},initUser(){(0,h.LP)("token")&&a.Z.dispatch("getUserInfo").then((t=>{null!==t.user_detail?(this.userDetail={...t.user_detail},this.userDetail.collect?this.collectIds=this.userDetail.collect.split(","):this.collectIds=[],this.collectIds.length>0&&(this.isCollect=!1,this.collectIds.find(((t,s)=>{1*t===1*this.query.id&&(this.isCollect=!0)}))),this.userDetail.good?this.goodIds=this.userDetail.good.split(","):this.goodIds=[],this.goodIds.length>0&&(this.isGood=!1,this.goodIds.find(((t,s)=>{1*t===1*this.query.id&&(this.isGood=!0)})))):this.userDetail={id:null,user_id:t.id,collect:"",good:""},this.commentForm={...t,address:localStorage.getItem("address"),user_id:t.id,essay_id:1*this.$route.query.id},delete this.commentForm.id}))},publishComment(){(0,h.LP)("token")?d(this.commentForm).then((t=>{this.initComments(),this.commentForm.message=""})):this.$msg({content:"请先登录",type:"warning"})},jumpToComment(){const t=document.getElementsByClassName("comment"),s=t[0].offsetTop;var e=this;(0,h.LP)("token")||this.$msg({content:"请先登录",type:"warning"});const i=setInterval((function(){const t=document.documentElement.scrollTop,o=s/35;t<=s+50?(document.documentElement.scrollTop=t+o,1*t>=s+1.5*o&&(e.publishShow=!0,clearInterval(i))):(document.documentElement.scrollTop=t-o,1*t<=s+1.5*o&&(e.publishShow=!0,clearInterval(i)))}),1)},addCollect(){(0,h.LP)("token")?(this.isCollect=!this.isCollect,this.isCollect?(this.essayData.collect++,this.collectIds.push(this.query.id)):(this.essayData.collect--,this.collectIds.splice(this.collectIds.indexOf(String(this.query.id)),1)),this.collectIds.length>1?this.userDetail.collect=this.collectIds.join(","):this.userDetail.collect=this.collectIds.join(""),(0,n.EI)(this.essayData).then((t=>{(0,l.f5)(this.userDetail).then((t=>{!0===this.isCollect?(this.$msg({content:"收藏成功，前往个人管理查看",type:"success"}),this.initEssay()):(this.$msg({content:"已取消收藏，前往个人管理查看",type:"info"}),this.initEssay())}))}))):this.$msg({content:"用户尚未登录",type:"warning"})},addGood(){(0,h.LP)("token")?(this.isGood=!this.isGood,this.isGood?(this.essayData.good++,this.goodIds.push(this.query.id)):(this.essayData.good--,this.goodIds.splice(this.goodIds.indexOf(String(this.query.id)),1)),this.goodIds.length>1?this.userDetail.good=this.goodIds.join(","):this.userDetail.good=this.goodIds.join(""),(0,n.EI)(this.essayData).then((t=>{(0,l.f5)(this.userDetail).then((t=>{!0===this.isGood?(this.$msg({content:"点赞成功",type:"success"}),this.initEssay()):(this.$msg({content:"已取消点赞",type:"info"}),this.initEssay())}))}))):this.$msg({content:"用户尚未登录",type:"warning"})}}},b=C,w=(0,p.Z)(b,i,o,!1,null,"775ff0a8",null),_=w.exports}}]);